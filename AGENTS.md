# add-principles Skill

向项目 AGENTS.md 添加通用原则的交互式 Skill。

## 功能

- 自动检测当前项目 AGENTS.md 状态
- 如无 AGENTS.md，自动执行 `/init` 创建
- 从 `principles.md` 读取原则库
- 智能检测重复，避免重复添加
- 先展示添加计划，确认后执行

## 使用方式

在 Kimi 中说出以下触发词：

- "添加原则"
- "增加规范"
- "给项目加原则"
- "同步原则"

## 交互流程

### 第一步：诊断当前项目

扫描当前目录，自动处理初始化：

```
📂 当前目录：C:\Users\wangz\projects\my-app

诊断结果：
✗ AGENTS.md 不存在

正在执行 /init 创建 AGENTS.md...
✓ AGENTS.md 创建成功
```

然后自动继续：

```
📂 当前目录：C:\Users\wangz\projects\my-app

诊断结果：
✓ AGENTS.md 已存在（0 个原则）

可用原则（来自 principles.md）：
   [1] Git工作流 - 分支策略、提交规范
   [2] 测试规范 - 单元测试要求
   [3] 代码审查 - PR流程、Review检查项
   [4] 安全规范 - 敏感信息管理

请选择要添加的原则 [1-4，可多选，空格分隔]：1 2
```

### 第二步：重复检测与计划生成

自动对比检测重复：

```
🔍 正在检查重复...

[1] Git工作流
   状态：✅ 无冲突，可直接添加

[2] 测试规范  
   状态：❌ 冲突 - 与现有"测试要求"内容相似度 72%
   操作选项：
      [r] 替换现有
      [k] 保留现有，跳过
      [m] 合并（人工确认差异）
```

处理冲突后生成计划：

```
📋 添加计划

目标文件：./AGENTS.md

操作详情：
   ➕ [新增] Git工作流（5条细则）
   🔄 [替换] 测试规范（将替换"测试要求"，4条→6条）

备份：将创建 AGENTS.md.bak.20240223

请选择：
   [y] 确认执行
   [p] 预览修改后的完整内容
   [e] 编辑（调整原则顺序）
   [n] 返回重新选择
   [q] 取消
```

### 第三步：执行与报告

```
✅ 执行完成

更新摘要：
   新增原则：1 个（Git工作流）
   替换原则：1 个（测试规范）
   保留原样：2 个

文件备份：AGENTS.md.bak.20240223
```

## 项目结构

```
add-principles/
├── AGENTS.md              # 本文件
├── README.md              # 用户说明
└── add-principles/
    ├── SKILL.md           # 核心交互流程
    ├── principles.md      # 原则库（用户维护）
    └── scripts/           # 执行脚本
```

## 原则库格式

`principles.md` 使用二级标题定义原则：

```markdown
## 原则名称
- 规则1
- 规则2
```

## 边界情况处理

| 情况 | 处理方式 |
|------|---------|
| `principles.md` 不存在 | 提示"请创建原则库文件" |
| `/init` 执行失败 | 提示初始化失败，建议手动执行 `/init` |
| 所有原则都已存在 | 提示"所有原则已同步，无需添加" |
| AGENTS.md 写入失败 | 保留备份，提示手动操作步骤 |
| 原则内容冲突（相似度60-99%） | 高亮显示，提供替换/保留/合并选项 |
| 完全重复（100%） | 自动跳过，提示"已存在" |
